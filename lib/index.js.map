{"version":3,"sources":["../src/index.js"],"names":["createExpoIn","pipe","strongerEaseIn","getBox","box","elm","getBoundingClientRect","top","window","scrollY","left","scrollX","width","height","fadeOutTween","element","options","from","to","ease","linear","start","style","opacity","v","pointerEvents","fadeInTween","values","easings","times","styler","set","pause","hideTween","seek","Math","round","visibility","t","hide","diffRect","a","b","translateY","translateX","scaleY","scaleX","Morph","elementFrom","elementTo","hideElements","fadeInElements","fadeOutElements","isPlaying","timeline","ref","push","progress","fadeIn","willChange","fadeOut","key","go","length","init","get","props","spring","update","x","forEach","morph","original","zIndex","easing","optEasing","target","originalRect","targetRect","originalCloneContainer","document","createElement","originalClone","cloneNode","appendChild","originalStyler","cloneStyler","targetStyler","position","transformOrigin","body","diffStyle","cloneTranslateIn","diffTargetStyles","targetTranslateFLIP","Object","keys","fadeOuts","map","fadeIns","hidesIns","renderedChildren","children","back","Children","only","propTypes","func","isRequired","shape","stiffness","number","mass","damping","defaultProps"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport propTypes from 'prop-types';\nimport keyframe from 'keyframe';\nimport {\n  css,\n  easing,\n  keyframes,\n  spring,\n  tween,\n  value,\n  transform,\n} from 'popmotion';\nimport { interpolateObject } from './util';\n\nconst { createExpoIn } = easing;\nconst { pipe } = transform;\nconst strongerEaseIn = createExpoIn(50);\n\nconst getBox = elm => {\n  const box = elm.getBoundingClientRect();\n  return {\n    top: box.top + window.scrollY,\n    left: box.left + window.scrollX,\n    width: box.width,\n    height: box.height,\n  };\n};\n\nconst fadeOutTween = ({ element, options = {} }) =>\n  tween({\n    from: 1,\n    to: 0,\n    ease: easing.linear,\n    ...options,\n  }).start(v => {\n    element.style.opacity = v;\n    if (v === 1) element.style.pointerEvents = 'all';\n  });\n\nconst fadeInTween = ({ element, options = {} }) =>\n  keyframes({\n    values: [{ opacity: 0 }, { opacity: 1 }],\n    easings: easing.linear,\n    times: [0.8, 1],\n    ...options,\n  })\n    .start(style => {\n      const styler = css(element);\n\n      styler.set(style);\n\n      if (style.opacity === 1) element.style.pointerEvents = 'all';\n    })\n    .pause();\n\nconst hideTween = ({ element, options = {} }) => ({\n  seek: pipe(Math.round, t => {\n    element.style.visibility = t > 0 ? 'hidden' : 'visible';\n  }),\n});\n\nconst hide = styler => t =>\n  styler.set({\n    opacity: t,\n    visibility: t > 0 ? 'visible' : 'hidden',\n  });\n\nconst diffRect = (a, b) => ({\n  translateY: a.top - b.top,\n  translateX: a.left - b.left,\n  scaleY: a.height / b.height,\n  scaleX: a.width / b.width,\n});\n\nclass Morph extends Component {\n  static propTypes = {\n    children: propTypes.func.isRequired,\n    spring: propTypes.shape({\n      stiffness: propTypes.number.isRequired,\n      mass: propTypes.number.isRequired,\n      damping: propTypes.number.isRequired,\n    }),\n  };\n\n  static defaultProps = {\n    spring: {\n      stiffness: 500,\n      mass: 5,\n      damping: 300,\n    },\n  };\n\n  elementFrom = {};\n  elementTo = {};\n\n  hideElements = [];\n  fadeInElements = [];\n  fadeOutElements = [];\n\n  isPlaying = false;\n  timeline = [];\n\n  hide = options => ({\n    ref: elm => {\n      const element = elm;\n      this.hideElements.push({ element, options });\n    },\n  });\n\n  progress = value(0, this.seek);\n\n  fadeIn = options => ({\n    ref: elm => {\n      const element = elm;\n      element.style.willChange = 'opacity';\n      element.style.pointerEvents = 'none';\n      element.style.opacity = 0;\n      this.fadeInElements.push({ element, options });\n    },\n  });\n\n  fadeOut = options => ({\n    ref: elm => {\n      const element = elm;\n      element.style.willChange = 'opacity';\n      this.fadeOutElements.push({ element, options });\n    },\n  });\n\n  from = (key, options) => ({\n    ref: elm => {\n      const element = elm;\n      element.style.willChange = 'transform';\n      this.elementFrom[key] = { element, options };\n    },\n  });\n\n  to = (key, options) => ({\n    ref: elm => {\n      const element = elm;\n      element.style.visibility = 'hidden';\n      element.style.opacity = 0;\n      element.style.willChange = 'transform';\n      this.elementTo[key] = { element, options };\n    },\n  });\n\n  go = (to, options = {}) => {\n    if (!this.timeline.length) {\n      this.init(to);\n      return;\n    }\n\n    spring({\n      from: this.progress.get(),\n      to,\n      ...this.props.spring,\n      ...options,\n    }).start(x => {\n      this.progress.update(x);\n      this.seek(x);\n    });\n  };\n\n  seek = t => {\n    this.timeline.forEach(x => x.seek(t));\n  };\n\n  /* eslint-disable max-statements */\n  morph = key => {\n    const {\n      element: original,\n      options: { zIndex, easing: optEasing = x => x, ...options } = {},\n    } = this.elementFrom[key];\n    const { element: target } = this.elementTo[key];\n\n    const originalRect = getBox(original);\n    const targetRect = getBox(target);\n    const originalCloneContainer = document.createElement('div');\n    const originalClone = original.cloneNode(true);\n\n    originalCloneContainer.appendChild(originalClone);\n\n    const originalStyler = css(original);\n    const cloneStyler = css(originalCloneContainer);\n    const targetStyler = css(target);\n\n    // originalStyler.set({ color: 'red' });\n    // cloneStyler.set({ color: 'green' });\n    // targetStyler.set({ color: 'blue' });\n\n    cloneStyler.set({\n      position: 'absolute',\n      transformOrigin: 'top left',\n      pointerEvents: 'none',\n      ...originalRect,\n      zIndex,\n    });\n    targetStyler.set({\n      'transform-origin': 'top left',\n      visibility: 'visible',\n    });\n\n    document.body.appendChild(originalCloneContainer);\n\n    const diffStyle = diffRect(targetRect, originalRect);\n\n    const cloneTranslateIn = interpolateObject(\n      { translateX: 0, translateY: 0, scaleX: 1, scaleY: 1 },\n      diffStyle,\n    );\n\n    const diffTargetStyles = diffRect(originalRect, targetRect);\n    const targetTranslateFLIP = interpolateObject(diffTargetStyles, {\n      translateX: 0,\n      translateY: 0,\n      scaleX: 1,\n      scaleY: 1,\n    });\n\n    this.timeline.push(\n      // In and out track.\n      {\n        seek: keyframe({\n          0.1: t => {\n            hide(originalStyler)(1 - t);\n          },\n\n          30: () => {},\n\n          100: t => {\n            hide(cloneStyler)(1 - t);\n          },\n        }),\n      },\n      // Full track.\n      {\n        seek: keyframe({\n          100: t => {\n            pipe(optEasing, cloneTranslateIn, cloneStyler.set)(t);\n            pipe(optEasing, targetTranslateFLIP, targetStyler.set)(t);\n          },\n        }),\n      },\n      // Half way.\n      {\n        seek: keyframe({\n          0.01: t => {\n            hide(cloneStyler)(t);\n          },\n          30: t => hide(targetStyler)(t),\n        }),\n      },\n    );\n\n    this.isPlaying = true;\n  };\n\n  init = () => {\n    if (this.timeline.length) return;\n\n    Object.keys(this.elementFrom).forEach(this.morph);\n\n    const fadeOuts = this.fadeOutElements.map(fadeOutTween);\n    const fadeIns = this.fadeInElements.map(fadeInTween);\n    const hidesIns = this.hideElements.map(hideTween);\n\n    this.timeline = [...fadeOuts, ...fadeIns, ...hidesIns, ...this.timeline];\n\n    this.go(1);\n  };\n\n  render() {\n    const renderedChildren = this.props.children({\n      from: this.from,\n      to: this.to,\n\n      fadeIn: this.fadeIn,\n      fadeOut: this.fadeOut,\n\n      back: this.back,\n      seek: this.seek,\n      go: this.go,\n\n      progress: this.progress,\n\n      hide: this.hide,\n      init: this.init,\n    });\n\n    return renderedChildren && React.Children.only(renderedChildren);\n  }\n}\n\nexport default Morph;\n"]}
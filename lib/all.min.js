"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_keyframe=require("keyframe"),_keyframe2=_interopRequireDefault(_keyframe),_popmotion=require("popmotion"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _objectWithoutProperties(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var createExpoIn=_popmotion.easing.createExpoIn,pipe=_popmotion.transform.pipe,strongerEaseIn=createExpoIn(50),getBox=function(e){var t=e.getBoundingClientRect();return{top:t.top+window.scrollY,left:t.left+window.scrollX,width:t.width,height:t.height}},fadeOutTween=function(e){var t=e.element,n=e.options,r=void 0===n?{}:n;return(0,_popmotion.tween)(Object.assign({from:1,to:0,ease:_popmotion.easing.linear},r)).start(function(e){t.style.opacity=e,1===e&&(t.style.pointerEvents="all")})},fadeInTween=function(e){var t=e.element,n=e.options,r=void 0===n?{}:n;return(0,_popmotion.keyframes)(Object.assign({values:[{opacity:0},{opacity:1}],easings:_popmotion.easing.linear,times:[.8,1]},r)).start(function(e){(0,_popmotion.css)(t).set(e),1===e.opacity&&(t.style.pointerEvents="all")}).pause()},hideTween=function(e){var t=e.element;e.options;return{seek:pipe(Math.round,function(e){t.style.visibility=e>0?"hidden":"visible"})}},hide=function(e){return function(t){return e.set({opacity:t,visibility:t>0?"visible":"hidden"})}},diffRect=function(e,t){return{translateY:e.top-t.top,translateX:e.left-t.left,scaleY:e.height/t.height,scaleX:e.width/t.width}},Morph=function(e){function t(){var e,n,r;_classCallCheck(this,t);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.elementFrom={},r.elementTo={},r.hideElements=[],r.fadeInElements=[],r.fadeOutElements=[],r.isPlaying=!1,r.timeline=[],r.hide=function(e){return{ref:function(t){var n=t;r.hideElements.push({element:n,options:e})}}},r.progress=(0,_popmotion.value)(0,r.seek),r.fadeIn=function(e){return{ref:function(t){var n=t;n.style.willChange="opacity",n.style.pointerEvents="none",n.style.opacity=0,r.fadeInElements.push({element:n,options:e})}}},r.fadeOut=function(e){return{ref:function(t){var n=t;n.style.willChange="opacity",r.fadeOutElements.push({element:n,options:e})}}},r.from=function(e,t){return{ref:function(n){var o=n;o.style.willChange="transform",r.elementFrom[e]={element:o,options:t}}}},r.to=function(e,t){return{ref:function(n){var o=n;o.style.visibility="hidden",o.style.opacity=0,o.style.willChange="transform",r.elementTo[e]={element:o,options:t}}}},r.go=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.timeline.length?(0,_popmotion.spring)(Object.assign({from:r.progress.get(),to:e},r.props.spring,t)).start(function(e){r.progress.update(e),r.seek(e)}):r.init(e)},r.seek=function(e){r.timeline.forEach(function(t){return t.seek(e)})},r.morph=function(e){var t=r.elementFrom[e],n=t.element,o=t.options,i=(o=void 0===o?{}:o).zIndex,s=o.easing,a=void 0===s?function(e){return e}:s,l=(_objectWithoutProperties(o,["zIndex","easing"]),r.elementTo[e].element),p=getBox(n),u=getBox(l),f=document.createElement("div"),c=n.cloneNode(!0);f.appendChild(c);var d=(0,_popmotion.css)(n),m=(0,_popmotion.css)(f),h=(0,_popmotion.css)(l);m.set(Object.assign({position:"absolute",transformOrigin:"top left",pointerEvents:"none"},p,{zIndex:i})),h.set({"transform-origin":"top left",visibility:"visible"}),document.body.appendChild(f);var y=diffRect(u,p),_=(0,_util.interpolateObject)({translateX:0,translateY:0,scaleX:1,scaleY:1},y),g=diffRect(p,u),b=(0,_util.interpolateObject)(g,{translateX:0,translateY:0,scaleX:1,scaleY:1});r.timeline.push({seek:(0,_keyframe2.default)({.1:function(e){hide(d)(1-e)},30:function(){},100:function(e){hide(m)(1-e)}})},{seek:(0,_keyframe2.default)({100:function(e){pipe(a,_,m.set)(e),pipe(a,b,h.set)(e)}})},{seek:(0,_keyframe2.default)({.01:function(e){hide(m)(e)},30:function(e){return hide(h)(e)}})}),r.isPlaying=!0},r.init=function(){if(!r.timeline.length){Object.keys(r.elementFrom).forEach(r.morph);var e=r.fadeOutElements.map(fadeOutTween),t=r.fadeInElements.map(fadeInTween),n=r.hideElements.map(hideTween);r.timeline=[].concat(_toConsumableArray(e),_toConsumableArray(t),_toConsumableArray(n),_toConsumableArray(r.timeline)),r.go(1)}},_possibleConstructorReturn(r,n)}return _inherits(t,_react.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.children({from:this.from,to:this.to,fadeIn:this.fadeIn,fadeOut:this.fadeOut,back:this.back,seek:this.seek,go:this.go,progress:this.progress,hide:this.hide,init:this.init});return e&&_react2.default.Children.only(e)}}]),t}();function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Morph.propTypes={children:_propTypes2.default.func.isRequired,spring:_propTypes2.default.shape({stiffness:_propTypes2.default.number.isRequired,mass:_propTypes2.default.number.isRequired,damping:_propTypes2.default.number.isRequired})},Morph.defaultProps={spring:{stiffness:500,mass:5,damping:300}},exports.default=Morph,Object.defineProperty(exports,"__esModule",{value:!0});var getValueFromProgress=function(e,t,n){return-n*e+n*t+e},interpolateObject=exports.interpolateObject=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){return Object.assign({},Object.keys(e).reduce(function(r,o){return Object.assign(_defineProperty({},o,getValueFromProgress(e[o],t[o],n)),r)},{}))}};exports.default={interpolateObject:interpolateObject};
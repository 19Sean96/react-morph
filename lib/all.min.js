"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_popmotion=require("popmotion");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var createExpoIn=_popmotion.easing.createExpoIn,strongerEaseIn=createExpoIn(5),hiddenStyle={visibility:"hidden"},onceDifferent=function(e,t){var n=t;return function(t){return n===t?n:(e(t),n=t)}},diffRect=function(e,t){return{translateY:e.top-t.top,translateX:e.left-t.left,scaleY:e.height/t.height,scaleX:e.width/t.width}},invert=function(e){return Object.keys(e).reduce(function(t,n){return Object.assign(_defineProperty({},n,-1*e[n]),t)},{})},Morph=function(e){function t(){var e,n,o;_classCallCheck(this,t);for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];return n=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),o.state={objects:[]},o.elementFrom={},o.elementTo={},o.fadeInElements=[],o.fadeOutElements=[],o.fadeIn=function(e){return{ref:function(t){t.style.willChange="opacity",t.style.opacity=0,o.fadeInElements.push({element:t,options:e})}}},o.fadeOut=function(e){return{ref:function(t){t.style.willChange="opacity",o.fadeOutElements.push({element:t,options:e})}}},o.from=function(e,t){return{ref:function(n){n.style.willChange="transform",o.elementFrom[e]={element:n,options:t}}}},o.to=function(e,t){return{ref:function(n){n.style.visibility="hidden",n.style.opacity=0,n.style.willChange="transform",o.elementTo[e]={element:n,options:t}}}},o.isPlaying=!1,o.timeline=[],o.hiddenProps=function(){},o.progress=(0,_popmotion.value)(0,o.seek),o.options={stiffness:500,mass:5,damping:300},o.go=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,_popmotion.spring)(Object.assign({from:o.progress.get(),to:e},o.options,t)).start(function(e){o.progress.update(e),o.seek(e)})},o.seek=function(e){o.timeline.forEach(function(t){return t.seek(e)})},o.init=function(e){if(o.timeline.length)return o.go(1);var t=1e3*e;Object.keys(o.elementFrom).forEach(function(e){var t,n=o.elementFrom[e],i=n.element,r=n.options,s=o.elementTo[e].element,a=i.getBoundingClientRect(),l=s.getBoundingClientRect(),p=document.createElement("div"),u=i.cloneNode(!0);p.appendChild(u);var c=(0,_popmotion.css)(i);console.log("original: ",i);var f=(0,_popmotion.css)(p),m=(0,_popmotion.css)(s);f.set(Object.assign({position:"absolute",transformOrigin:"top left",pointerEvents:"none",top:a.top,left:a.left,width:a.width,height:a.height},r)),document.body.appendChild(p);var y=(0,_popmotion.keyframes)({values:[1,0],times:[0,.1],easings:_popmotion.easing.linear}),d=diffRect(l,a),h=(0,_popmotion.keyframes)({values:[{translateX:0,translateY:0,scaleX:1,scaleY:1},d],easings:_popmotion.easing.linear}),g=(0,_popmotion.keyframes)({values:[{opacity:1},{opacity:0}],easings:_popmotion.easing.linear,times:[.9,1]});m.set({"transform-origin":"top left",visibility:"visible"});var _,b=diffRect(a,l),v=(0,_popmotion.keyframes)({values:[Object.assign({},b),{translateX:0,translateY:0,scaleX:1,scaleY:1}],easings:_popmotion.easing.linear}),C=(0,_popmotion.keyframes)({values:[{opacity:0},{opacity:1}],easings:_popmotion.easing.linear}),O=(0,_popmotion.tween)({from:1e3*b.scaleX,to:100,easings:_popmotion.easing.linear}).start(function(e){u.style.backgroundSize=e+"% 100%"}).pause();(t=o.timeline).push.apply(t,[y.start((_=c,function(e){return _.set({opacity:e,visibility:e?"visible":"hidden"})})).pause(),h.start(f.set).pause(),g.start(f.set).pause(),C.start(m.set).pause(),v.start(m.set).pause(),O]),o.isPlaying=!0});var n=o.fadeOutElements.map(function(e){var n=e.element,o=e.options,i=void 0===o?{}:o;return(0,_popmotion.tween)(Object.assign({from:1,to:0,ease:_popmotion.easing.linear,duration:t/2},i)).start(function(e){return n.style.opacity=e})}),i=o.fadeInElements.map(function(e){var t=e.element;e.options;return(0,_popmotion.keyframes)({values:[0,1],easings:_popmotion.easing.strongerEaseIn,times:[.8,.9]}).start(function(e){return t.style.opacity=e}).pause()});o.timeline=[].concat(_toConsumableArray(n),_toConsumableArray(i),_toConsumableArray(o.timeline)),o.go(1)},_possibleConstructorReturn(o,n)}return _inherits(t,_react.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.children({from:this.from,to:this.to,fadeIn:this.fadeIn,fadeOut:this.fadeOut,back:this.back,seek:this.seek,go:this.go,hiddenProps:this.hiddenProps,init:this.init});return e&&_react2.default.Children.only(e)}}]),t}();exports.default=Morph;